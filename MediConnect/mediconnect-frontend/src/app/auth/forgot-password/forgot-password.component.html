<div style="text-align:center;margin-bottom:1.5rem;">
  <h2 style="margin:0;color:#1976d2;font-weight:700;">MediConnect</h2>
</div>
<div class="register-link" style="text-align:center;margin-top:1rem;">
  <span>Remember your password? <a routerLink="/auth/login">Login</a></span>
</div>
<p-toast></p-toast>

<div class="forgot-password-container">
  <p-card [header]="showResetForm ? 'Reset Password' : 'Forgot Password'" styleClass="forgot-password-card">
    
    <!-- Step 1: Forgot Password Form -->
    <div *ngIf="!showResetForm">
      <p style="color: #666; margin-bottom: 1.5rem;">
        Enter your username and we'll send you instructions to reset your password.
      </p>
      
      <form [formGroup]="forgotPasswordForm" (ngSubmit)="onForgotPassword()">
        <div class="form-group">
          <label for="username">Username</label>
          <input pInputText id="username" type="text" formControlName="username" placeholder="Enter your username" />
          <small class="p-error" *ngIf="forgotPasswordForm.get('username')?.invalid && forgotPasswordForm.get('username')?.touched">
            Please enter a valid username (minimum 3 characters)
          </small>
        </div>
        
        <div class="form-group">
          <button pButton type="submit" label="Send Reset Instructions" class="full-width" 
                  [loading]="loading" [disabled]="loading || forgotPasswordForm.invalid"></button>
        </div>
      </form>
    </div>

    <!-- Step 2: Reset Password Form -->
    <div *ngIf="showResetForm">
      <p style="color: #666; margin-bottom: 1.5rem;">
        Enter your new password below.
      </p>
      
      <form [formGroup]="resetPasswordForm" (ngSubmit)="onResetPassword()">
        <div class="form-group">
          <label for="newPassword">New Password</label>
          <p-password id="newPassword" formControlName="newPassword" 
                     placeholder="Enter new password" [feedback]="true" [toggleMask]="true"></p-password>
          <small class="p-error" *ngIf="resetPasswordForm.get('newPassword')?.invalid && resetPasswordForm.get('newPassword')?.touched">
            Password must be at least 8 characters long
          </small>
        </div>
        
        <div class="form-group">
          <label for="confirmPassword">Confirm New Password</label>
          <p-password id="confirmPassword" formControlName="confirmPassword" 
                     placeholder="Confirm new password" [feedback]="false" [toggleMask]="true"></p-password>
          <small class="p-error" *ngIf="resetPasswordForm.errors?.['passwordMismatch'] && resetPasswordForm.get('confirmPassword')?.touched">
            Passwords do not match
          </small>
        </div>
        
        <div class="form-group">
          <button pButton type="submit" label="Reset Password" class="full-width" 
                  [loading]="loading" [disabled]="loading || resetPasswordForm.invalid"></button>
        </div>
        
        <div class="form-group" style="text-align: center;">
          <button pButton type="button" label="Back to Login" 
                  class="p-button-text" (click)="goBackToLogin()"></button>
        </div>
      </form>
    </div>
  </p-card>
</div>

<style>
.forgot-password-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 80vh;
}
.forgot-password-card {
  width: 400px;
  padding: 2rem;
}
.form-group {
  margin-bottom: 1.5rem;
  display: flex;
  flex-direction: column;
}
.full-width {
  width: 100%;
}
.p-error {
  color: #f44336;
  font-size: 0.75rem;
  margin-top: 0.25rem;
}
</style>