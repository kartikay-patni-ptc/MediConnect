<div class="history">
  <p-accordion [multiple]="true">
    <p-accordionTab header="Medication History" [selected]="true">
      <div class="mb-2" style="display:flex; justify-content:flex-end; gap:.5rem;">
        <p-button icon="pi pi-plus" label="Add" size="small" (onClick)="openAdd()"></p-button>
      </div>
      <p-dialog header="Medication" [(visible)]="showAdd" [modal]="true" [style]="{width: '28rem'}">
        <div class="grid" style="row-gap:.75rem;">
          <div class="col-12"><input pInputText placeholder="Medication name" [(ngModel)]="form.medicationName"></div>
          <div class="col-6"><input pInputText placeholder="Dosage" [(ngModel)]="form.dosage"></div>
          <div class="col-6"><input pInputText placeholder="Frequency" [(ngModel)]="form.frequency"></div>
          <div class="col-6"><input pInputText placeholder="Start YYYY-MM-DD" [(ngModel)]="form.startDate"></div>
          <div class="col-6"><input pInputText placeholder="End YYYY-MM-DD" [(ngModel)]="form.endDate"></div>
          <div class="col-12"><textarea pInputTextarea placeholder="Notes" rows="3" [(ngModel)]="form.notes"></textarea></div>
          <div class="col-12" style="display:flex; justify-content:flex-end; gap:.5rem;">
            <p-button label="Save" icon="pi pi-check" (onClick)="save()"></p-button>
          </div>
        </div>
      </p-dialog>
      <div class="table-wrap">
        <p-table [value]="medications" responsiveLayout="scroll">
          <ng-template pTemplate="header">
            <tr>
              <th>Medication</th>
              <th>Dosage</th>
              <th>Frequency</th>
              <th>Start</th>
              <th>End</th>
              <th>Actions</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-item>
            <tr>
              <td>{{ item.medicationName }}</td>
              <td>{{ item.dosage }}</td>
              <td>{{ item.frequency }}</td>
              <td>{{ item.startDate }}</td>
              <td>{{ item.endDate || '-' }}</td>
              <td>
                <p-button icon="pi pi-pencil" class="p-button-text p-button-sm" (onClick)="edit(item)"></p-button>
                <p-button icon="pi pi-trash" class="p-button-text p-button-sm" (onClick)="remove(item.id)"></p-button>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </p-accordionTab>

    <p-accordionTab header="Allergies" [selected]="true">
      <div class="table-wrap">
        <p-table [value]="allergies" responsiveLayout="scroll">
          <ng-template pTemplate="header">
            <tr>
              <th>Allergen</th>
              <th>Reaction</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-item>
            <tr>
              <td>{{ item.allergen }}</td>
              <td>{{ item.reaction }}</td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </p-accordionTab>

    <p-accordionTab header="Medical Reports" [selected]="true">
      <div class="table-wrap">
        <p-table [value]="reports" responsiveLayout="scroll">
          <ng-template pTemplate="header">
            <tr>
              <th>Type</th>
              <th>Date</th>
              <th>Summary</th>
              <th>File</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-item>
            <tr>
              <td>{{ item.type }}</td>
              <td>{{ item.date }}</td>
              <td>{{ item.summary }}</td>
              <td>
                <a *ngIf="item.fileUrl" [href]="item.fileUrl" target="_blank">Download</a>
                <span *ngIf="!item.fileUrl">-</span>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </p-accordionTab>
  </p-accordion>
</div>



