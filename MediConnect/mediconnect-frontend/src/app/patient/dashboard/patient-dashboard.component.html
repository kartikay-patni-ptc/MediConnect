<div class="container mx-auto p-4">
  <p-toast></p-toast>
  
  <!-- Header -->
  <div class="mb-4">
    <div class="flex justify-content-between align-items-center">
      <h1 class="text-3xl font-bold text-900">Patient Dashboard</h1>
      <div class="flex gap-2">
        <p-button label="Edit Profile" icon="pi pi-user-edit" (onClick)="editProfile()"></p-button>
        <p-button label="Logout" icon="pi pi-sign-out" severity="secondary" (onClick)="logout()"></p-button>
      </div>
    </div>
  </div>

  <div class="grid">
    <!-- Patient Profile Card -->
    <div class="col-12 lg:col-4">
      <p-card header="My Profile" styleClass="shadow-2 h-full">
        <div *ngIf="patient; else noProfile" class="space-y-3">
          <div class="flex align-items-center gap-3">
            <i class="pi pi-user text-4xl text-primary"></i>
            <div>
              <h3 class="text-xl font-semibold">{{ patient.firstName }} {{ patient.lastName }}</h3>
              <p class="text-600">{{ patient.email }}</p>
            </div>
          </div>
          <div class="space-y-2">
            <div class="flex justify-content-between">
              <span class="font-medium">Phone:</span>
              <span>{{ patient.phoneNumber }}</span>
            </div>
            <div class="flex justify-content-between">
              <span class="font-medium">Gender:</span>
              <span>{{ patient.gender }}</span>
            </div>
            <div class="flex justify-content-between">
              <span class="font-medium">Age:</span>
              <span>{{ patient.dateOfBirth | date:'yyyy-MM-dd' }}</span>
            </div>
          </div>
        </div>
        <ng-template #noProfile>
          <div class="text-center py-4">
            <i class="pi pi-user text-4xl text-400 mb-3"></i>
            <p class="text-600">Profile not set up</p>
            <p-button label="Setup Profile" (onClick)="editProfile()" class="mt-3"></p-button>
          </div>
        </ng-template>
      </p-card>
    </div>

    <!-- Prescriptions Card -->
    <div class="col-12 lg:col-8">
      <p-card header="Recent Prescriptions" styleClass="shadow-2 h-full">
        <p-table [value]="prescriptions" [paginator]="true" [rows]="3" 
                 [showCurrentPageReport]="true" responsiveLayout="scroll"
                 currentPageReportTemplate="Showing {first} to {last} of {totalRecords} prescriptions">
          <ng-template pTemplate="header">
            <tr>
              <th>Date</th>
              <th>Doctor</th>
              <th>Diagnosis</th>
              <th>Medications</th>
              <th>Actions</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-prescription>
            <tr>
              <td>{{ prescription.date | date:'shortDate' }}</td>
              <td>{{ prescription.doctorName }}</td>
              <td>{{ prescription.diagnosis }}</td>
              <td>
                <ul class="list-none p-0 m-0">
                  <li *ngFor="let med of prescription.medications" class="text-sm">{{ med }}</li>
                </ul>
              </td>
              <td>
                <p-button icon="pi pi-download" 
                          severity="secondary" 
                          size="small"
                          (onClick)="downloadPrescription(prescription)"
                          pTooltip="Download PDF">
                </p-button>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </p-card>
    </div>

    <!-- Doctor Search Section -->
    <div class="col-12">
      <p-card header="Find Doctors" styleClass="shadow-2">
        <div class="mb-4">
          <div class="flex gap-3 align-items-center">
            <span class="p-input-icon-left flex-1">
              <i class="pi pi-search"></i>
              <input pInputText type="text" 
                     [(ngModel)]="searchTerm" 
                     (input)="searchDoctors()"
                     placeholder="Search doctors by specialization or name..." 
                     class="w-full"
                     [disabled]="isLoading">
            </span>
            <p-button *ngIf="searchTerm && searchTerm.trim()" 
                      icon="pi pi-times" 
                      severity="secondary" 
                      (onClick)="clearSearch()"
                      pTooltip="Clear search">
            </p-button>
            <p-button *ngIf="isLoading" 
                      icon="pi pi-spin pi-spinner" 
                      severity="secondary" 
                      [loading]="true"
                      label="Searching...">
            </p-button>
          </div>
          <small class="text-500 mt-2 block">
            <i class="pi pi-info-circle mr-1"></i>
            Try searching for specializations like: cardiology, neurology, orthopedics, dermatology, pediatrics
          </small>
        </div>

        <div class="grid">
          <div class="col-12 md:col-6 lg:col-4" *ngFor="let doctor of filteredDoctors">
            <p-card styleClass="shadow-1 h-full">
              <ng-template pTemplate="header">
                <div class="text-center py-3">
                  <i class="pi pi-user-md text-4xl text-primary"></i>
                </div>
              </ng-template>
              <ng-template pTemplate="body">
                <div class="text-center space-y-2">
                  <h3 class="text-lg font-semibold">Dr. {{ doctor.firstName }} {{ doctor.lastName }}</h3>
                  <p class="text-primary font-medium">{{ doctor.specialization }}</p>
                  <p class="text-600 text-sm">{{ doctor.experience }} years experience</p>
                  <p class="text-600 text-sm">{{ doctor.hospital }}</p>
                </div>
              </ng-template>
              <ng-template pTemplate="footer">
                <div class="flex gap-2">
                  <p-button label="Book Appointment" 
                            icon="pi pi-calendar-plus"
                            (onClick)="bookAppointment(doctor)"
                            class="flex-1">
                  </p-button>
                </div>
              </ng-template>
            </p-card>
          </div>
        </div>

        <div *ngIf="filteredDoctors.length === 0 && !isLoading" class="text-center py-8">
          <i class="pi pi-search text-4xl text-400 mb-3"></i>
          <p class="text-600" *ngIf="!searchTerm || !searchTerm.trim()">Search for doctors by specialization or name</p>
          <p class="text-600" *ngIf="searchTerm && searchTerm.trim()">No doctors found matching your search criteria</p>
          <p class="text-500 text-sm mt-2">
            Try searching for specializations like: cardiology, neurology, orthopedics, dermatology, pediatrics
          </p>
        </div>
        
        <div *ngIf="isLoading" class="text-center py-8">
          <i class="pi pi-spin pi-spinner text-4xl text-primary mb-3"></i>
          <p class="text-600">Searching for doctors...</p>
        </div>
      </p-card>
    </div>
  </div>
</div>