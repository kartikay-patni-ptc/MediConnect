<p-toast></p-toast>
<div class="min-h-screen flex bg-gray-50">
  <!-- Desktop Sidebar -->
  <aside class="bg-white border-r border-gray-200 w-72 shrink-0 hidden lg:flex lg:flex-col" [class.hidden]="!isSidebarOpen">
    <div class="p-4 flex items-center gap-3 border-b border-gray-200">
      <p-avatar label="DO" shape="circle" styleClass="bg-blue-500 text-white"></p-avatar>
      <div>
        <div class="font-semibold">Dr. Kartikay</div>
        <div class="text-sm text-gray-500">Cardiologist</div>
      </div>
    </div>

    <nav class="p-3 space-y-1">
      <button *ngFor="let n of navItems" (click)="onNavClick(n.id)" class="w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700">
        <i [class]="n.icon"></i>
        <span class="font-medium">{{ n.label }}</span>
      </button>
    </nav>
  </aside>

  <!-- Mobile Sidebar -->
  <p-sidebar [(visible)]="mobileSidebar" position="left" styleClass="w-80" [modal]="true">
    <div class="p-4 flex items-center gap-3 border-b">
      <p-avatar label="DO" shape="circle" styleClass="bg-blue-500 text-white"></p-avatar>
      <div>
        <div class="font-semibold">Dr. Onichaan</div>
        <div class="text-sm text-gray-500">Cardiologist</div>
      </div>
    </div>
    <nav class="p-3 space-y-1">
      <button *ngFor="let n of navItems" (click)="onNavClick(n.id)" class="w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700">
        <i [class]="n.icon"></i>
        <span class="font-medium">{{ n.label }}</span>
      </button>
    </nav>
  </p-sidebar>

  <!-- Main Content -->
  <main class="flex-1 min-w-0">
    <!-- Top Toolbar -->
    <p-toolbar styleClass="px-4 lg:px-6 py-3 bg-white border-b border-gray-200 sticky top-0 z-10">
      <div class="p-toolbar-group-start flex items-center gap-3">
        <button pButton icon="pi pi-bars" class="p-button-text lg:hidden" (click)="openMobileSidebar()" pTooltip="Menu"></button>
        <p-breadcrumb [model]="breadcrumbItems" [home]="breadcrumbHome" styleClass="hidden sm:block"></p-breadcrumb>
      </div>
      <div class="p-toolbar-group-end flex items-center gap-2">
        <span class="p-input-icon-left mr-2">
          <i class="pi pi-search"></i>
          <input pInputText type="text" placeholder="Search appointments" [(ngModel)]="searchQuery" (input)="onGlobalFilter()" class="w-44 sm:w-64" />
        </span>
        <p-splitButton label="New" icon="pi pi-plus" [model]="actionItems"></p-splitButton>
        <button pButton icon="pi pi-bell" class="p-button-text" pTooltip="Notifications"></button>
        <button pButton icon="pi pi-home" class="p-button-outlined p-button-sm" (click)="goToHome()" pTooltip="Go to Home"></button>
        <button pButton icon="pi pi-sign-out" class="p-button-danger p-button-outlined p-button-sm" (click)="logout()" pTooltip="Logout"></button>
        <p-avatar label="DO" shape="circle"></p-avatar>
      </div>
    </p-toolbar>

    <div class="p-4 lg:p-6">
      <div class="max-w-7xl mx-auto space-y-6">
        <div class="flex items-center justify-between">
          <h2 class="text-xl lg:text-2xl font-semibold">Dashboard</h2>
          <button pButton type="button" class="p-button-text hidden lg:inline-flex" (click)="toggleSidebar()">
  <i class="pi" [ngClass]="isSidebarOpen ? 'pi-times' : 'pi-bars'"></i>
</button>
        </div>

        <!-- Upload Prescription Dialog -->
        <p-dialog header="Upload Prescription" [(visible)]="showUploadDialog" [modal]="true" [style]="{width: '32rem'}">
          <p-fileUpload name="prescriptions[]" mode="advanced" [customUpload]="true" (uploadHandler)="onUpload($event)" chooseLabel="Choose" uploadLabel="Upload" cancelLabel="Cancel" accept=".pdf,.jpg,.jpeg,.png" [maxFileSize]="5000000"></p-fileUpload>
        </p-dialog>

        <!-- Gradient Greeting Card -->
        <div class="rounded-lg shadow-sm bg-gradient-to-r from-blue-50 to-indigo-50 p-5">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-2xl font-semibold">{{ greeting }}</div>
              <div class="text-gray-600 mt-1">Here’s a quick overview of your day.</div>
            </div>
            <img src="assets/illustrations/doctor-hero.svg" alt="Doctor" class="h-20 w-auto" />
          </div>
        </div>

        <!-- Stats: Single Row -->
        <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6">
          <p-card class="rounded-lg shadow-sm h-full">
            <ng-template pTemplate="title">Total Patients</ng-template>
            <ng-template pTemplate="content">
              <div class="text-3xl font-bold">{{ patientStats.totalPatients }}</div>
              <div class="text-gray-500">active patients</div>
            </ng-template>
          </p-card>
          <p-card class="rounded-lg shadow-sm h-full">
            <ng-template pTemplate="title">New this week</ng-template>
            <ng-template pTemplate="content">
              <div class="text-3xl font-bold">{{ patientStats.newThisWeek }}</div>
              <div class="text-gray-500">registered</div>
            </ng-template>
          </p-card>
          <p-card class="rounded-lg shadow-sm h-full">
            <ng-template pTemplate="title">Awaiting</ng-template>
            <ng-template pTemplate="content">
              <div class="text-3xl font-bold">{{ patientStats.awaiting }}</div>
              <div class="text-gray-500">in queue</div>
            </ng-template>
          </p-card>
        </div>

        <!-- Grid Layout -->
        <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
          <!-- Left Column: Schedule + Table -->
          <div class="space-y-6 xl:col-span-2">
            <!-- Today’s Schedule -->
            <p-card class="rounded-lg shadow-sm">
              <ng-template pTemplate="title">Today’s Schedule</ng-template>
              <ng-template pTemplate="content">
                <div class="space-y-2">
                  <div *ngFor="let s of todaySchedule" class="group flex items-center justify-between rounded-md px-3 py-3 hover:bg-gray-50">
                    <div class="flex items-center gap-3">
                      <i class="pi pi-clock text-gray-500"></i>
                      <div>
                        <div class="font-medium">{{ s.time }}</div>
                        <div class="text-gray-500 text-sm">{{ s.patient }}</div>
                      </div>
                    </div>
                    <p-tag [value]="s.type" severity="info"></p-tag>
                  </div>
                </div>
              </ng-template>
            </p-card>

            <!-- Upcoming Appointments Table -->
            <p-card class="rounded-lg shadow-sm">
              <ng-template pTemplate="title">Upcoming Appointments</ng-template>
              <ng-template pTemplate="content">
                <p-table #dataTable [value]="upcomingAppointments" [globalFilterFields]="['id','patientName','time','type','status']" [paginator]="true" [rows]="5" [rowsPerPageOptions]="[5,10]" styleClass="p-datatable-sm p-datatable-striped p-datatable-hover rounded-lg">
                  <ng-template pTemplate="header">
                    <tr>
                      <th>Appointment ID</th>
                      <th>Patient</th>
                      <th>Time</th>
                      <th>Type</th>
                      <th>Status</th>
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-row>
                    <tr>
                      <td>{{ row.id }}</td>
                      <td class="flex items-center gap-2">
                        <p-avatar icon="pi pi-user" shape="circle"></p-avatar>
                        <span>{{ row.patientName }}</span>
                      </td>
                      <td>{{ row.time }}</td>
                      <td>{{ row.type }}</td>
                      <td>
                        <p-tag [value]="row.status" [severity]="getStatusSeverity(row.status)"></p-tag>
                      </td>
                    </tr>
                  </ng-template>

                  <ng-template pTemplate="emptymessage">
                    <tr>
                      <td colspan="5">
                        <div class="text-center py-10 text-gray-500">No appointments found</div>
                      </td>
                    </tr>
                  </ng-template>
                </p-table>
              </ng-template>
            </p-card>
          </div>

          <!-- Right Column: Calendar -->
          <div class="space-y-6">
            <p-card class="rounded-lg shadow-sm">
              <ng-template pTemplate="title">Calendar</ng-template>
              <ng-template pTemplate="content">
                <p-calendar [(ngModel)]="selectedDate" [inline]="true"></p-calendar>
              </ng-template>
            </p-card>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>