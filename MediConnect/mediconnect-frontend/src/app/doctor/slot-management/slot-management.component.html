<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="min-h-screen bg-gray-50 p-6">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Slot Management</h1>
          <p class="text-gray-600 mt-2">Manage your available time slots for patient appointments</p>
        </div>
        <button pButton 
                label="Add New Slot" 
                icon="pi pi-plus" 
                class="p-button-primary"
                (click)="openAddSlotDialog()">
        </button>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <div class="bg-white rounded-lg shadow-sm p-6">
        <div class="flex items-center">
          <div class="p-3 bg-blue-100 rounded-full">
            <i class="pi pi-clock text-blue-600 text-xl"></i>
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-600">Total Slots</p>
            <p class="text-2xl font-bold text-gray-900">{{ slots.length }}</p>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-sm p-6">
        <div class="flex items-center">
          <div class="p-3 bg-green-100 rounded-full">
            <i class="pi pi-check-circle text-green-600 text-xl"></i>
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-600">Available Slots</p>
            <p class="text-2xl font-bold text-gray-900">{{ getAvailableSlotsCount() }}</p>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-lg shadow-sm p-6">
        <div class="flex items-center">
          <div class="p-3 bg-red-100 rounded-full">
            <i class="pi pi-times-circle text-red-600 text-xl"></i>
          </div>
          <div class="ml-4">
            <p class="text-sm font-medium text-gray-600">Booked Slots</p>
            <p class="text-2xl font-bold text-gray-900">{{ getBookedSlotsCount() }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Slots Table -->
    <div class="bg-white rounded-lg shadow-sm">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-medium text-gray-900">Time Slots</h3>
      </div>
      
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date & Time</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Duration</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <tr *ngIf="loading" class="text-center">
              <td colspan="4" class="px-6 py-4">
                <div class="flex items-center justify-center">
                  <i class="pi pi-spin pi-spinner text-blue-600 text-xl mr-2"></i>
                  <span class="text-gray-600">Loading slots...</span>
                </div>
              </td>
            </tr>
            
            <tr *ngIf="!loading && slots.length === 0" class="text-center">
              <td colspan="4" class="px-6 py-8">
                <div class="text-center">
                  <i class="pi pi-calendar-times text-gray-400 text-4xl mb-3"></i>
                  <p class="text-gray-600 text-lg">No time slots found</p>
                  <p class="text-gray-500">Create your first time slot to start accepting appointments</p>
                </div>
              </td>
            </tr>
            
            <tr *ngFor="let slot of slots" class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900">
                  {{ formatDateTime(slot.startTime) }}
                </div>
                <div class="text-sm text-gray-500">
                  to {{ formatDateTime(slot.endTime) }}
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {{ getSlotDuration(slot.startTime, slot.endTime) }}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full"
                      [ngClass]="slot.available ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'">
                  {{ slot.available ? 'Available' : 'Booked' }}
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <div class="flex space-x-2">
                  <button pButton 
                          [label]="slot.available ? 'Make Unavailable' : 'Make Available'"
                          [icon]="slot.available ? 'pi pi-times' : 'pi pi-check'"
                          [class]="slot.available ? 'p-button-danger p-button-sm' : 'p-button-success p-button-sm'"
                          (click)="toggleSlotAvailability(slot)"
                          pTooltip="Toggle slot availability">
                  </button>
                  <button pButton 
                          label="Delete" 
                          icon="pi pi-trash" 
                          class="p-button-danger p-button-outlined p-button-sm"
                          (click)="deleteSlot(slot)"
                          pTooltip="Delete this slot">
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Add Slot Dialog -->
<p-dialog [(visible)]="showAddSlotDialog" 
          header="Add New Time Slot" 
          [modal]="true" 
          [style]="{width: '500px'}"
          [draggable]="false" 
          [resizable]="false">
  
  <form [formGroup]="slotForm" (ngSubmit)="addSlot()" class="space-y-4">
    <div class="field">
      <label for="date" class="block text-sm font-medium text-gray-700 mb-2">Date</label>
      <p-calendar formControlName="date" 
                  [showIcon]="true" 
                  dateFormat="dd/mm/yy"
                  placeholder="Select date"
                  class="w-full">
      </p-calendar>
    </div>
    
    <div class="grid grid-cols-2 gap-4">
      <div class="field">
        <label for="startTime" class="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
        <p-calendar formControlName="startTime" 
                    [timeOnly]="true" 
                    [showTime]="true"
                    [showSeconds]="false"
                    
                    placeholder="Start time"
                    class="w-full">
        </p-calendar>
      </div>
      
      <div class="field">
        <label for="endTime" class="block text-sm font-medium text-gray-700 mb-2">End Time</label>
        <p-calendar formControlName="endTime" 
                    [timeOnly]="true" 
                    [showTime]="true"
                    [showSeconds]="false"
                    
                    placeholder="End time"
                    class="w-full">
        </p-calendar>
      </div>
    </div>
  </form>
  
  <ng-template pTemplate="footer">
    <div class="flex justify-end space-x-2">
      <button pButton 
              label="Cancel" 
              class="p-button-text"
              (click)="showAddSlotDialog = false">
      </button>
      <button pButton 
              label="Add Slot" 
              icon="pi pi-plus"
              class="p-button-primary"
              [disabled]="!slotForm.valid"
              (click)="addSlot()">
      </button>
    </div>
  </ng-template>
</p-dialog>